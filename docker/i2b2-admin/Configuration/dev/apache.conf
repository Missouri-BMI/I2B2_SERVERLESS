# Server configuration for Shrine and i2b2 proxying

# Adjust the ServerName to your specific domain or IP
ServerName https://shrine-washu-dev.nextgenbmi.umsystem.edu/
Timeout 300
ProxyTimeout 300

# Disable proxy requests from external clients
ProxyRequests Off
ProxyPreserveHost Off

# Redirect base URL to /shrine
RedirectMatch ^/$ /shrine

# Proxy configuration for /shrine/
<Location /shrine/>
    Require all granted
    ProxyPass http://localhost:6060/shrine-api/shrine-webclient
    ProxyPassReverse http://localhost:6060/shrine-api/shrine-webclient
</Location>

# Use reverse proxy for /i2b2/services/
<Location /i2b2/services/>
    Require ip 127.0.0.1
    ProxyPass http://127.0.0.1:8080/i2b2/services/
    ProxyPassReverse http://127.0.0.1:8080/i2b2/services/
</Location>

# Serve a custom HTML page for /admin
<Location /admin>
    Require all granted
    DirectoryIndex index.php
</Location>

# Health check endpoint with server-status
<Location /health>
    AuthType None
    Require all granted
    SetHandler server-status
</Location>
